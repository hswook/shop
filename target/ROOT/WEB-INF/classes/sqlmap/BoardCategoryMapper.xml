<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.re.nnpc.www.modules.board.category.BoardCategoryMapper">
	<sql id="table_name">board_category</sql>

	<select id="getList" resultType="BoardCategory">
		SELECT
			*
		FROM <include refid="table_name"/>
		ORDER BY id
	</select>
	
	<select id="getListByParentId" resultType="BoardCategory" parameterType="int">
		SELECT
			*
		FROM <include refid="table_name"/>
		WHERE parent_id = #{parent_id}
		ORDER BY id
	</select>
	
	<select id="getByBoardFileId" parameterType="long" resultType="BoardCategory">
		SELECT c2.*
		FROM
		  <include refid="table_name"/> f
		  LEFT JOIN board_post p ON p.id = f.post_id
		  LEFT JOIN board_config c1 ON p.config_id = c1.id
		  LEFT JOIN board_category c2 ON c2.id = c1.category_id
		WHERE f.id = #{id}
	</select>
	
	<select id="getById" parameterType="int" resultType="BoardCategory">
		SELECT * FROM <include refid="table_name"/>
		WHERE id = #{id}
	</select>
	
	<insert id="insert" parameterType="BoardCategory">
		INSERT INTO <include refid="table_name"/>
		(parent_id, id, name, description, home_url)
		VALUES
		(#{parent_id}, #{id}, #{name}, #{description}, #{home_url})
	</insert>
	
	<delete id="deleteById" parameterType="int">
		DELETE FROM <include refid="table_name"/>
		WHERE id = #{id}
	</delete>
	
	<update id="update" parameterType="BoardCategory">
		MERGE INTO <include refid="table_name"/> t1
		USING (SELECT 1 FROM DUAL)
		ON (t1.id = #{id})
		WHEN MATCHED THEN
		  UPDATE SET
			t1.parent_id = #{parent_id}
			,t1.name = #{name}
			,t1.description = #{description}
			,t1.home_url = #{home_url}
		WHEN NOT MATCHED THEN
			INSERT
				(t1.parent_id, t1.id, t1.name, t1.description, t1.home_url)
			VALUES
				(#{parent_id}, #{id}, #{name}, #{description}, #{home_url})
	</update>
	
</mapper>